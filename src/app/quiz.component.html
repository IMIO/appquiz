
<!-- Interface joueur harmonisée avec le style maître du jeu -->

<!-- Étapes simplifiées -->
<div *ngIf="step === 'lobby'" class="player-step-banner lobby">
  <b>🎮 WAITING FOR GAME</b><br>
  <span>Registration and waiting for host validation</span>
</div>

<div *ngIf="step === 'waiting'" class="player-step-banner waiting">
  <b>⏳ READY TO START</b><br>
  <span>Registration closed, waiting for host to start</span>
</div>

<div *ngIf="!quizFinished && currentQuestion" class="quiz-container">
  <!-- Score banner harmonisé -->
  <div class="score-banner">
    <img *ngIf="avatarUrl" [src]="avatarUrl" alt="avatar" class="avatar" />
    <span *ngIf="!avatarUrl" class="avatar">👤</span>
    <span class="score-label">My Score:</span>
    <span class="score-value">{{ totalScore }} / {{ totalQuestions }} pts</span>
  </div>

  <!-- Feedback de la dernière réponse -->
  <div class="score-detail" *ngIf="personalScore">
    <span *ngIf="personalScore.good" class="score-good">✅ Correct answer!</span>
    <span *ngIf="personalScore.bad" class="score-bad">❌ Wrong answer</span>
    <span *ngIf="personalScore.none" class="score-none">⏱️ No answer</span>
  </div>

  <!-- Bannière d'étape question masquée -->
  <!-- <div *ngIf="step === 'question'" class="player-step-banner question">
    <b>❓ QUESTION</b><br>
    <span>Answer before time runs out!</span>
  </div> -->

  <!-- Titre de la question -->
  <h2 class="question-title">{{ currentQuestion.text }}</h2>

  <!-- Timer (style maître du jeu) -->
  <div class="timer" *ngIf="step === 'question'">
    <div *ngIf="waitingForStart" class="timer-waiting">Waiting for start...</div>
    <ng-container *ngIf="!waitingForStart">
      <div class="timer-bar-container" *ngIf="timerValue > 0 && timerMax > 0">
        <div class="timer-bar" [ngStyle]="{width: (timerValue / timerMax * 100) + '%'}"></div>
        <span class="timer-bar-label">{{ timerValue }}s</span>
      </div>
      <div *ngIf="timerValue <= 0" class="player-timer-end">⏰ Time's up!</div>
    </ng-container>
  </div>

  <!-- Options de réponse (style maître du jeu) -->
  <ul class="options-list">
    <li *ngFor="let option of currentQuestion.options; let i = index">
      <button
        class="option-btn"
        (click)="selectAnswer(i)"
        [disabled]="!timerActive || answerSubmitted || step === 'result'"
        [class.option-correct]="step === 'result' && i === currentQuestion.correctIndex"
        [class.option-incorrect]="step === 'result' && selectedAnswerIndex === i && i !== currentQuestion.correctIndex"
        [class.option-selected]="selectedAnswerIndex === i && (step === 'question' || answerSubmitted)"
      >
        <span *ngIf="selectedAnswerIndex === i && (step === 'question' || answerSubmitted)" class="option-selected-icon">👉</span>
        {{ option }}
        <span *ngIf="step === 'result' && i === currentQuestion.correctIndex" style="margin-left: auto; color: #43a047; font-weight: bold;">✓</span>
      </button>
    </li>
  </ul>

  <!-- Résultat -->
  <div *ngIf="step === 'result'">
    <div class="player-step-banner result">
      <b>📊 RESULT</b><br>
      <span>Waiting for next question...</span>
    </div>
  </div>
</div>

<!-- Quiz terminé (style harmonisé) -->
<div *ngIf="quizFinished" class="quiz-finished-container">
  <h2>🏁 Quiz Completed!</h2>
  
  <!-- Score final -->
  <div class="score-banner">
    <img *ngIf="avatarUrl" [src]="avatarUrl" alt="avatar" class="avatar" />
    <span *ngIf="!avatarUrl" class="avatar">👤</span>
    <span class="score-label">Final Score:</span>
    <span class="score-value">{{ totalScore }} / {{ totalQuestions }} pts</span>
  </div>

  <!-- Leaderboard final -->
  <h3 style="margin-top: 2em; color: #232526;">🏆 Final Ranking</h3>
  <ol class="joueur-leaderboard-list">
    <li *ngFor="let user of leaderboard; let i = index" class="joueur-leaderboard-item">
      <span class="joueur-leaderboard-rank">{{ i + 1 }}</span>
      <img *ngIf="user.avatarUrl" [src]="user.avatarUrl" alt="avatar" width="32" height="32" style="border-radius: 50%; border: 2px solid #1976d2;" />
      <span style="font-weight: bold;">{{ user.name }}</span>
      <span style="margin-left: auto; font-weight: bold; color: #232526;">{{ user.score }} / {{ totalQuestions }} pts</span>
    </li>
  </ol>
</div>
