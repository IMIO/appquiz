
<!-- Interface joueur harmonisÃ©e avec le style maÃ®tre du jeu -->
ur de loading discret -->
<div *ngIf="isLoading" class="loading-bar">
  <div class="loading-progress"></div>
  <span class="loading-text">{{ loadingMessage }}</span>
</div>

<!-- Ã‰tapes simplifiÃ©es -->
<div *ngIf="step === 'lobby'" class="player-step-banner lobby">
  <b>ğŸ® WAITING FOR GAME</b><br>
  <span>Registration and waiting for host validation</span>
</div>

<div *ngIf="step === 'waiting'" class="player-step-banner waiting">
  <b>â³ READY TO START</b><br>
  <span>Registration closed, waiting for host to start</span>
</div>

<div *ngIf="!quizFinished && currentQuestion" class="quiz-container">
  <!-- Score banner harmonisÃ© -->
  <div class="score-banner">
    <img *ngIf="avatarUrl" [src]="avatarUrl" alt="avatar" class="avatar" />
    <span *ngIf="!avatarUrl" class="avatar">ğŸ‘¤</span>
    <span class="score-label">My Score:</span>
    <span class="score-value">{{ totalScore }} / {{ totalQuestions }} pts</span>
  </div>

  <!-- Feedback de la derniÃ¨re rÃ©ponse -->
  <div class="score-detail" *ngIf="personalScore">
    <span *ngIf="personalScore.good" class="score-good">âœ… Correct answer!</span>
    <span *ngIf="personalScore.bad" class="score-bad">âŒ Wrong answer</span>
    <span *ngIf="personalScore.none" class="score-none">â±ï¸ No answer</span>
  </div>

  <!-- BanniÃ¨re d'Ã©tape question masquÃ©e -->
  <!-- <div *ngIf="step === 'question'" class="player-step-banner question">
    <b>â“ QUESTION</b><br>
    <span>Answer before time runs out!</span>
  </div> -->

  <!-- Titre de la question avec numÃ©ro -->
  <div class="question-header">
    <div class="question-number">Question NumÃ©ro {{ currentQuestionNumber }}</div>
    <h2 class="question-title">{{ currentQuestion.text }}</h2>
  </div>

  <!-- Timer unifiÃ© - Toujours visible pendant les questions -->
  <div class="timer step-timer" *ngIf="step === 'question' || (currentQuestion && step !== 'result')">
    <div class="timer-bar-container" [ngClass]="{'timer-active': timerActive && questionStartTime > 0, 'timer-waiting': !timerActive || questionStartTime <= 0}">
      <div class="timer-bar" 
           [ngStyle]="{width: questionStartTime > 0 ? (timerValue / timerMax * 100) + '%' : '100%'}"
           [ngClass]="{'timer-bar-active': timerActive && questionStartTime > 0}"></div>
      <span class="timer-bar-label" [ngClass]="{'timer-active': timerActive && questionStartTime > 0}">
        <span *ngIf="timerActive && questionStartTime > 0">{{ timerValue }}s</span>
        <span *ngIf="questionStartTime > 0 && !timerActive">Timer arrÃªtÃ©</span>
      </span>
    </div>
    
    <!-- Message unifiÃ© d'attente pour les joueurs -->
    <div *ngIf="questionStartTime <= 0" style="margin-top: 10px; padding: 12px; background: #fff3cd; border-radius: 6px; font-size: 0.95em; color: #856404; text-align: center;">
      â³ En attente du dÃ©marrage du timer par le maÃ®tre du jeu...<br>
      <small style="opacity: 0.8; margin-top: 4px; display: block;">Les rÃ©ponses seront activÃ©es une fois le timer lancÃ©</small>
    </div>
    
  </div>

        <!-- Options de rÃ©ponses -->
  <ul class="options-list">
    <li *ngFor="let option of currentQuestion.options; let i = index">
      <button
        class="option-btn"
        (click)="selectAnswer(i)"
        [disabled]="!canPlay || activeStep === 'result'"
        [class.option-correct]="(activeStep === 'result' || activeStep === 'waiting') && i === currentQuestion.correctIndex"
        [class.option-incorrect]="(activeStep === 'result' || activeStep === 'waiting') && selectedAnswerIndex === i && i !== currentQuestion.correctIndex"
        [class.option-selected]="selectedAnswerIndex === i && isQuestionOrResultStep"
      >


        <span *ngIf="selectedAnswerIndex === i && isQuestionOrResultStep" class="option-selected-icon">ğŸ‘‰</span>
        {{ option }}
        <span *ngIf="(activeStep === 'result' || activeStep === 'waiting') && i === currentQuestion.correctIndex" style="margin-left: auto; color: #43a047; font-weight: bold;">âœ“</span>
        <span *ngIf="(activeStep === 'result' || activeStep === 'waiting') && selectedAnswerIndex === i && i !== currentQuestion.correctIndex" style="margin-left: auto; color: #c62828; font-weight: bold;">âœ—</span>
      </button>
    </li>
  </ul>

  <!-- RÃ©sultat avec informations dÃ©taillÃ©es -->
  <div *ngIf="activeStep === 'result'" class="result-section">
    <!-- Affichage du rÃ©sultat de la rÃ©ponse du joueur -->
    <div class="player-result-banner">
      <div *ngIf="selectedAnswerIndex !== null && selectedAnswerIndex >= 0" class="answer-feedback">
        <div *ngIf="isAnswerCorrect" class="correct-feedback">
          âœ… <strong>Bonne rÃ©ponse !</strong>
        </div>
        <div *ngIf="isAnswerCorrect === false" class="incorrect-feedback">
          âŒ <strong>RÃ©ponse incorrecte</strong>
        </div>
      </div>
      <div *ngIf="selectedAnswerIndex === null || selectedAnswerIndex < 0" class="no-answer-feedback">
        â° <strong>Temps Ã©coulÃ© - Aucune rÃ©ponse</strong>
      </div>
    </div>
    
    <!-- Affichage de la bonne rÃ©ponse -->
    <div class="correct-answer-display">
      <h4>ğŸ’¡ La bonne rÃ©ponse Ã©tait :</h4>
      <div class="correct-answer-text" *ngIf="currentQuestion && currentQuestion.correctIndex !== undefined">
        {{ currentQuestion.options[currentQuestion.correctIndex] }}
      </div>
    </div>
    
    <div class="player-step-banner result">
      <b>ğŸ“Š RÃ‰SULTATS</b><br>
      <span>En attente de la question suivante...</span>
    </div>
  </div>
</div>

<!-- Quiz terminÃ© (style harmonisÃ©) -->
<div *ngIf="quizFinished" class="quiz-finished-container">
  <h2>ğŸ Quiz Completed!</h2>
  
  <!-- Score final -->
  <div class="score-banner">
    <img *ngIf="avatarUrl" [src]="avatarUrl" alt="avatar" class="avatar" />
    <span *ngIf="!avatarUrl" class="avatar">ğŸ‘¤</span>
    <span class="score-label">Final Score:</span>
    <span class="score-value">{{ totalScore }} / {{ totalQuestions }} pts</span>
  </div>

  <!-- Leaderboard final -->
  <h3 style="margin-top: 2em; color: #232526;">ğŸ† Final Ranking</h3>
  <ol class="joueur-leaderboard-list">
    <li *ngFor="let user of leaderboard; let i = index" class="joueur-leaderboard-item">
      <span class="joueur-leaderboard-rank">{{ i + 1 }}</span>
      <img *ngIf="user.avatarUrl" [src]="user.avatarUrl" alt="avatar" width="32" height="32" style="border-radius: 50%; border: 2px solid #1976d2;" />
      <span style="font-weight: bold;">{{ user.name }}</span>
      <span style="margin-left: auto; font-weight: bold; color: #232526;">{{ user.score }} / {{ totalQuestions }} pts</span>
    </li>
  </ol>
</div>
