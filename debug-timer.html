<!DOCTYPE html>
<html>
<head>
    <title>Debug Timer Sync - Quiz App</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-panel { 
            border: 1px solid #ccc; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px;
            background: #f9f9f9;
        }
        .timer-display { 
            font-size: 2em; 
            font-weight: bold; 
            color: #2196F3;
        }
        .sync-info { 
            font-size: 0.9em; 
            color: #666; 
        }
        .error { color: red; }
        .success { color: green; }
        .logs { 
            max-height: 200px; 
            overflow-y: scroll; 
            background: #000; 
            color: #0f0; 
            padding: 10px; 
            font-family: monospace; 
            font-size: 0.8em;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            background: #2196F3;
            color: white;
        }
        button:hover { background: #1976D2; }
    </style>
</head>
<body>
    <h1>üîÑ Debug Timer Synchronisation</h1>
    
    <div class="debug-panel">
        <h3>√âtat du Timer</h3>
        <div class="timer-display" id="timerDisplay">--:--</div>
        <div class="sync-info" id="syncInfo">En attente...</div>
        <button onclick="forceSync()">üîÑ Force Sync</button>
        <button onclick="clearLogs()">üóëÔ∏è Clear Logs</button>
    </div>
    
    <div class="debug-panel">
        <h3>Donn√©es Serveur</h3>
        <div id="serverData">...</div>
    </div>
    
    <div class="debug-panel">
        <h3>Logs de Synchronisation</h3>
        <div class="logs" id="logs"></div>
    </div>

    <script>
        let syncInterval;
        
        function log(message) {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logs.innerHTML += `[${timestamp}] ${message}\n`;
            logs.scrollTop = logs.scrollHeight;
        }
        
        async function fetchServerData() {
            try {
                const response = await fetch('http://localhost:3000/api/quiz-state');
                const data = await response.json();
                
                document.getElementById('timerDisplay').textContent = 
                    data.isTimerActive ? `${data.timeRemaining}s` : 'Inactif';
                    
                document.getElementById('syncInfo').textContent = 
                    `Timer Max: ${data.timerMax}s | Active: ${data.isTimerActive ? 'Oui' : 'Non'} | Server Time: ${data.serverTime}`;
                    
                document.getElementById('serverData').innerHTML = `
                    <strong>Step:</strong> ${data.step}<br>
                    <strong>Question Index:</strong> ${data.currentQuestionIndex}<br>
                    <strong>Question Start Time:</strong> ${data.questionStartTime}<br>
                    <strong>Time Remaining:</strong> ${data.timeRemaining}s<br>
                    <strong>Timer Max:</strong> ${data.timerMax}s<br>
                    <strong>Is Timer Active:</strong> ${data.isTimerActive}<br>
                    <strong>Server Time:</strong> ${new Date(data.serverTime).toLocaleTimeString()}
                `;
                
                log(`‚úÖ Sync: ${data.timeRemaining}s restant, active=${data.isTimerActive}`);
                
            } catch (error) {
                log(`‚ùå Erreur: ${error.message}`);
                document.getElementById('syncInfo').textContent = 'Erreur de synchronisation';
            }
        }
        
        function forceSync() {
            log('üîÑ Force sync demand√©e');
            fetchServerData();
        }
        
        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }
        
        // Synchronisation automatique toutes les 500ms
        syncInterval = setInterval(fetchServerData, 500);
        
        // Sync initiale
        fetchServerData();
        
        log('üöÄ Debug timer d√©marr√© - sync toutes les 500ms');
    </script>
</body>
</html>